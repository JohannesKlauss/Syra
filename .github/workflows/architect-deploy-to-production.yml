name: Deploy to production

env:
  ARCHITECT_EMAIL: ${{ secrets.ARCHITECT_EMAIL }}
  ARCHITECT_PASSWORD: ${{ secrets.ARCHITECT_PASSWORD }}
  ARCHITECT_ACCOUNT: ${{ secrets.ARCHITECT_ACCOUNT }}

on:
  release:
    types:
      - published
    branches:
      - master
    tags:
      - v*.*.*

jobs:
  architect:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: install architect
        run: yarn add @architect-io/cli -W
      - name: login
        run: architect login # credentials provided by envs ARCHITECT_EMAIL/ARCHITECT_PASSWORD
      - name: Tag architect component
        run: architect register --tag ${{ github.ref }} ./services/architect.yml
      - name: deploy to production
        run: |
          architect deploy --environment production