# Migration `20201022150132-added-basic-live-platform`

This migration has been generated by Johannes Klauss at 10/22/2020, 5:01:32 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "syra_int"."Project" ADD COLUMN "isPrivate" boolean   NOT NULL DEFAULT false

CREATE TABLE "syra_int"."FeedItem" (
"id" text   NOT NULL ,
"text" text   NOT NULL ,
"ownerId" text   NOT NULL ,
"isPublished" boolean   NOT NULL DEFAULT true,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"publishAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "syra_int"."FeedItemRevision" (
"id" text   NOT NULL ,
"text" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"feedItemId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "syra_int"."Comment" (
"id" text   NOT NULL ,
"text" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"feedItemId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "syra_int"."FeedItemLike" (
"feedItemId" text   NOT NULL ,
"userId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("userId","feedItemId")
)

CREATE TABLE "syra_int"."CommentLike" (
"commentId" text   NOT NULL ,
"userId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("userId","commentId")
)

ALTER TABLE "syra_int"."FeedItem" ADD FOREIGN KEY ("ownerId")REFERENCES "syra_int"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "syra_int"."FeedItemRevision" ADD FOREIGN KEY ("feedItemId")REFERENCES "syra_int"."FeedItem"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "syra_int"."Comment" ADD FOREIGN KEY ("feedItemId")REFERENCES "syra_int"."FeedItem"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "syra_int"."FeedItemLike" ADD FOREIGN KEY ("feedItemId")REFERENCES "syra_int"."FeedItem"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "syra_int"."FeedItemLike" ADD FOREIGN KEY ("userId")REFERENCES "syra_int"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "syra_int"."CommentLike" ADD FOREIGN KEY ("commentId")REFERENCES "syra_int"."Comment"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "syra_int"."CommentLike" ADD FOREIGN KEY ("userId")REFERENCES "syra_int"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201021123622-fix-typo-in-early-access-code-table-name..20201022150132-added-basic-live-platform
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -18,8 +18,9 @@
 model User {
   id                String      @id @default(cuid())
   name              String
   email             String      @unique
+  /// @TypeGraphQL.omit(output: true)
   password          String
   avatar            String?
   createdAt         DateTime    @default(now())
   updatedAt         DateTime    @updatedAt
@@ -29,12 +30,14 @@
   followedBy        User[]      @relation("UserFollows", references: [id])
   following         User[]      @relation("UserFollows", references: [id])
   memberOfProjects  UsersOnProjects[]
   ownsProjects      Project[]
+  feed              FeedItem[]
   interests         Tag[]
 }
 model Address {
+  /// @TypeGraphQL.omit(output: true)
   id            String      @id @default(cuid())
   addressLine1  String
   addressLine2  String?
   zip           Int
@@ -45,8 +48,9 @@
   updatedAt     DateTime    @updatedAt
 }
 model EarlyAccessCode {
+  /// @TypeGraphQL.omit(output: true)
   id            String      @id @default(cuid())
   code          String      @unique
   isValid       Boolean     @default(true)
   claimedBy     User?
@@ -57,8 +61,9 @@
 model Project {
   id            String      @id @default(cuid())
   owner         User        @relation(fields: [ownerId], references: [id])
   ownerId       String
+  isPrivate     Boolean     @default(false)
   createdAt     DateTime    @default(now())
   updatedAt     DateTime    @updatedAt
   members       UsersOnProjects[]
 }
@@ -73,12 +78,64 @@
   @@id([userId, projectId])
 }
 model Tag {
+  /// @TypeGraphQL.omit(output: true)
   id            String      @id @default(cuid())
   value         String      @unique()
 }
+model FeedItem {
+  id            String      @id @default(cuid())
+  text          String
+  owner         User        @relation(fields: [ownerId], references: [id])
+  ownerId       String
+  comments      Comment[]
+  likes         FeedItemLike[]
+  revisions     FeedItemRevision[]
+  isPublished   Boolean     @default(true)
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+  publishAt     DateTime?   @default(now())
+}
+
+model FeedItemRevision {
+  id            String      @id @default(cuid())
+  text          String
+  parentItem    FeedItem
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+}
+
+model Comment {
+  id            String      @id @default(cuid())
+  text          String
+  feedItem      FeedItem
+  likes         CommentLike[]
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+}
+
+model FeedItemLike {
+  feedItem      FeedItem    @relation(fields: [feedItemId], references: [id])
+  feedItemId    String
+  user          User        @relation(fields: [userId], references: [id])
+  userId        String
+  createdAt     DateTime    @default(now())
+
+  @@id([userId, feedItemId])
+}
+
+model CommentLike {
+  comment       Comment     @relation(fields: [commentId], references: [id])
+  commentId     String
+  user          User        @relation(fields: [userId], references: [id])
+  userId        String
+  createdAt     DateTime    @default(now())
+
+  @@id([userId, commentId])
+}
+
 enum Role {
   ADMIN
   MODERATOR
   USER
```


